<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Granicer Ceramica - Dynamic PDF</title>

  <!-- Required Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #f4f7f6;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }
    input {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .btn {
      display: inline-block;
      background: linear-gradient(135deg, #ed3237 0%, #b82329 100%);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
      font-weight: 600;
      outline: 2px solid #ed3237;
    }
    .btn:hover {
      transform: scale(1.05);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th,
    td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: center;
      font-size: 0.9em;
    }
    thead {
      background: linear-gradient(135deg, #ed3237 0%, #b82329 100%);
      color: white;
    }
    .delete-btn {
      background: #ff6b6b;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
    }
    .delete-btn:hover {
      background: #ff5252;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 style="text-align:center; color:#ed3237;">Granicer Ceramica - Price List</h2>
    <input type="text" id="size" placeholder="Enter Size" />
    <input type="text" id="surface" placeholder="Enter Surface" />
    <input type="number" id="price" placeholder="Enter Price" />
    <button class="btn" onclick="addItem()">Add</button>
    <button class="btn" onclick="generatePDF()">Generate PDF</button>

    <div id="itemsContainer"></div>
  </div>

  <script>
    const { jsPDF } = window.jspdf;
    let items = [];

    function addItem() {
      const size = document.getElementById("size").value.trim();
      const surface = document.getElementById("surface").value.trim();
      const price = document.getElementById("price").value.trim();

      if (!size || !surface || !price) {
        alert("Please fill all fields");
        return;
      }
      items.push({ size, surface, price: parseFloat(price) });
      renderItems();
      document.getElementById("size").value = "";
      document.getElementById("surface").value = "";
      document.getElementById("price").value = "";
    }

    function deleteItem(idx) {
      items.splice(idx, 1);
      renderItems();
    }

    function renderItems() {
      const container = document.getElementById("itemsContainer");
      if (items.length === 0) {
        container.innerHTML =
          "<p style='color:#999;text-align:center;'>No items added yet</p>";
        return;
      }
      let html = `
        <table>
          <thead>
            <tr><th>Sr</th><th>Size</th><th>Surface</th><th>Price</th><th>Action</th></tr>
          </thead>
          <tbody>`;
      items.forEach(
        (i, idx) =>
          (html += `<tr><td>${idx + 1}</td><td>${i.size}</td><td>${i.surface}</td><td>₹ ${i.price.toFixed(
            2
          )}</td><td><button class="delete-btn" onclick="deleteItem(${idx})">Delete</button></td></tr>`)
      );
      html += `</tbody></table>`;
      container.innerHTML = html;
    }

    async function generatePDF() {
      if (items.length === 0) {
        alert("Please add items first");
        return;
      }

      const element = document.createElement("div");
      element.innerHTML = generatePDFContent();
      document.body.appendChild(element);

      // Calculate dynamic height
      const baseHeight = 296.5; // A4 base
      const baseRows = 10;
      const rowHeightMM = 12.7;
      const totalRows = items.length;
      const extraRows = totalRows > baseRows ? totalRows - baseRows : 0;
      const totalHeight = baseHeight + extraRows * rowHeightMM;

      const canvas = await html2canvas(element, { scale: 2 });
      const imgData = canvas.toDataURL("image/jpeg", 1.0);

      const pdf = new jsPDF({
        orientation: "portrait",
        unit: "mm",
        format: [210, totalHeight],
      });

      const pdfWidth = 210;
      const pdfHeight = totalHeight;

      pdf.addImage(imgData, "JPEG", 0, 0, pdfWidth, pdfHeight);
      pdf.save("Granicer_PriceList.pdf");
      element.remove();
    }

    function generatePDFContent() {
      let rows = items
        .map(
          (i, idx) =>
            `<tr><td>${idx + 1}</td><td>${i.size}</td><td>${i.surface}</td><td>₹ ${i.price.toFixed(
              2
            )}</td></tr>`
        )
        .join("");

      return `
        <div style="width:210mm; background:white; padding:20px; font-family:'Poppins',sans-serif;">
          <h2 style="text-align:center; color:#ed3237;">Granicer Ceramica - Price List</h2>
          <table style="width:100%; border-collapse:collapse; margin-top:10px;">
            <thead style="background:#ed3237; color:white;">
              <tr><th>Sr</th><th>Size</th><th>Surface</th><th>Price</th></tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>
          <div style="margin-top:15px; text-align:center; font-size:10pt; color:#999;">
            Generated on: ${new Date().toLocaleDateString("en-GB")}
          </div>
        </div>`;
    }
  </script>
</body>
</html>
